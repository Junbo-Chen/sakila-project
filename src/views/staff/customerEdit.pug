extends ../layout

block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h2.text-primary 
      i.bi.bi-person-gear.me-2
      | Klant Bewerken
    a.btn.btn-secondary(href="/staff/customers")
      i.bi.bi-arrow-left.me-1
      | Terug naar Klanten

  // Succesmelding
  if success
    .alert.alert-success.alert-dismissible.fade.show
      i.bi.bi-check-circle.me-2
      | De klantgegevens zijn succesvol opgeslagen!
      button.btn-close(type="button" data-bs-dismiss="alert")

  // Foutmelding
  if error
    .alert.alert-danger.alert-dismissible.fade.show
      i.bi.bi-exclamation-triangle.me-2
      != error
      button.btn-close(type="button" data-bs-dismiss="alert")

  if customer
    .card
      .card-header.bg-primary.text-white
        h5.mb-0 
          i.bi.bi-person.me-2
          | #{customer.first_name} #{customer.last_name}
      .card-body
        form(method="POST" action=`/staff/customer/${customer.customer_id}/edit` id="customerForm")
          .row
            .col-md-6
              .mb-3
                label.form-label(for="first_name") 
                  | Voornaam 
                  span.text-danger 
                input.form-control(
                  type="text" 
                  name="first_name" 
                  id="first_name" 
                  value=customer.first_name || ''
                  required
                  maxlength="45"
                  placeholder="Voer de voornaam in"
                )
                .form-text.text-muted Verplicht veld
              
              .mb-3
                label.form-label(for="last_name") 
                  | Achternaam 
                  span.text-danger 
                input.form-control(
                  type="text" 
                  name="last_name" 
                  id="last_name" 
                  value=customer.last_name || ''
                  required
                  maxlength="45"
                  placeholder="Voer de achternaam in"
                )
                .form-text.text-muted Verplicht veld
              
              .mb-3
                label.form-label(for="email") 
                  | E-mailadres 
                  span.text-danger 
                input.form-control(
                  type="email" 
                  name="email" 
                  id="email" 
                  value=customer.email || ''
                  required
                  maxlength="50"
                  placeholder="voorbeeld@email.nl"
                )
                .form-text.text-muted Verplicht veld - moet uniek zijn
              
              .mb-3
                .form-check
                  input.form-check-input(
                    type="checkbox" 
                    name="active" 
                    id="active" 
                    checked=customer.active === 1 || customer.active === true
                  )
                  label.form-check-label(for="active") 
                    | Klant is actief
                .form-text.text-muted Inactieve klanten kunnen geen films huren

            .col-md-6
              .mb-3
                label.form-label(for="address") Adres
                input.form-control(
                  type="text" 
                  name="address" 
                  id="address" 
                  required
                  value=customer.address || ''
                  maxlength="50"
                  placeholder="Straat + huisnummer"
                )
              
              .mb-3
                label.form-label(for="city") Stad
                input.form-control(
                  type="text" 
                  name="city" 
                  id="city"
                  required 
                  value=customer.city || ''
                  maxlength="50"
                  placeholder="Plaatsnaam"
                )
                .form-text.text-muted 
              
              .mb-3
                label.form-label(for="country") Land
                input.form-control(
                  type="text" 
                  name="country" 
                  id="country" 
                  required
                  value=customer.country || ''
                  maxlength="50"
                  placeholder="Landnaam"
                )

              
              .mb-3
                .card.bg-light
                  .card-header
                    h6.mb-0 Klantinformatie
                  .card-body.py-3
                    .row.g-2.small
                      .col-6
                        strong Klantnummer: 
                        span.text-primary #{customer.customer_id}
                      .col-6
                        strong Status: 
                        if customer.active
                          span.badge.bg-success Actief
                        else
                          span.badge.bg-secondary Inactief
                      .col-6
                        strong Films gehuurd: 
                        span.text-info #{customer.total_rentals || 0}
                      .col-6
                        strong Laatste verhuur: 
                        | #{customer.last_rental_date ? new Date(customer.last_rental_date).toLocaleDateString('nl-NL') : 'Nog nooit'}
                      .col-12.mt-2
                        strong Klant sinds: 
                        | #{customer.create_date ? new Date(customer.create_date).toLocaleDateString('nl-NL') : 'Onbekend'}

          hr.my-4

          .row
            .col-12
              .d-flex.justify-content-between.align-items-center
                div
                  button.btn.btn-success(type="submit" id="saveBtn")
                    i.bi.bi-check-circle.me-1
                    | Opslaan
                  
                  a.btn.btn-outline-secondary.ms-2(href="/staff/customers")
                    i.bi.bi-x-circle.me-1
                    | Annuleren

  else
    .alert.alert-warning.text-center.py-5
      h4.mb-3
        i.bi.bi-exclamation-triangle.me-2
        | Klant niet gevonden
      p.mb-4 De opgevraagde klant kon niet worden gevonden.
      a.btn.btn-primary(href="/staff/customers")
        i.bi.bi-arrow-left.me-1
        | Terug naar Klanten

  // Gebruiksvriendelijke JavaScript
  script.
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('customerForm');
      const saveBtn = document.getElementById('saveBtn');
      
      if (form && saveBtn) {
        // Toon loading tijdens opslaan
        form.addEventListener('submit', function(e) {
          saveBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Bezig met opslaan...';
          saveBtn.disabled = true;
        });
        
        // Simpele validatie feedback
        const requiredFields = form.querySelectorAll('input[required]');
        requiredFields.forEach(function(field) {
          field.addEventListener('blur', function() {
            if (this.value.trim() === '') {
              this.style.borderColor = '#dc3545';
            } else {
              this.style.borderColor = '#198754';
            }
          });
        });
      }
      
      // Automatisch verdwijnen van meldingen
      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(function(alert) {
        setTimeout(function() {
          if (alert.classList.contains('alert-success')) {
            const closeBtn = alert.querySelector('.btn-close');
            if (closeBtn) closeBtn.click();
          }
        }, 5000); // Succesmeldingen verdwijnen na 5 seconden
      });
    });