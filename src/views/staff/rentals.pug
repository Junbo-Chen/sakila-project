extends ../layout

block content
  .d-flex.justify-content-between.align-items-center.mb-4
    h2.text-primary 
      i.bi.bi-film.me-2
      | Actieve Verhuur
    a.btn.btn-success(href="/staff/rentalCreate")
      i.bi.bi-plus-circle.me-2
      | Nieuwe Verhuur
  
  if rentals && rentals.length
    .card
      .card-header.bg-primary.text-white
        h5.mb-0 Actieve Verhuur (#{rentals.length})
      .card-body.p-0
        .table-responsive
          table.table.table-striped.table-hover.mb-0
            thead.table-dark
              tr
                th Rental ID
                th Klant
                th Film
                th Verhuur Datum
                th Dagen Verhuurd
                th Tarief
                th Status
                th Acties
            tbody
              each rental in rentals
                tr(class=rental.days_rented > 7 ? 'table-warning' : '')
                  td #{rental.rental_id}
                  td
                    strong #{rental.customer_name}
                    br
                    small.text-muted ID: #{rental.customer_id}
                  td
                    strong #{rental.film_title}
                  td #{new Date(rental.rental_date).toLocaleDateString('nl-NL')}
                  td
                    span.badge(class=rental.days_rented > 7 ? 'bg-warning text-dark' : (rental.days_rented > 3 ? 'bg-info' : 'bg-success'))
                      | #{rental.days_rented} dagen
                  td €#{rental.rental_rate}
                  td
                    if rental.days_rented > 7
                      span.badge.bg-warning Te laat
                    else if rental.days_rented > 3  
                      span.badge.bg-info Bijna verlopen
                    else
                      span.badge.bg-success Actief
                  td
                    button.btn.btn-sm.btn-success(onclick=`returnRental(${rental.rental_id})`)
                      i.bi.bi-check-circle.me-1
                      | Retourneer

        // ✅ Pagination toegevoegd
        if totalPages > 1
          nav.mt-3
            ul.pagination.justify-content-center
              li.page-item(class=currentPage === 1 ? 'disabled' : '')
                a.page-link(href=`/staff/rentals?page=${currentPage - 1}`) Vorige

              each num in [...Array(totalPages).keys()].map(n => n + 1)
                li.page-item(class=num === currentPage ? 'active' : '')
                  a.page-link(href=`/staff/rentals?page=${num}`) #{num}

              li.page-item(class=currentPage === totalPages ? 'disabled' : '')
                a.page-link(href=`/staff/rentals?page=${currentPage + 1}`) Volgende

  else
    .alert.alert-info.text-center
      h4 
        i.bi.bi-info-circle.me-2
        | Geen actieve verhuur
      p Er zijn momenteel geen actieve verhuur transacties.
      a.btn.btn-primary(href="/staff/rentals/new") Start nieuwe verhuur

  script.
    function returnRental(rentalId) {
      if (confirm('Weet je zeker dat je deze verhuur wilt retourneren?')) {
        fetch(`/staff/rentals/return/${rentalId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload();
          } else {
            alert('Error: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Er is een fout opgetreden');
        });
      }
    }
